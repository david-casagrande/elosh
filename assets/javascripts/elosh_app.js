Ember.Handlebars.helper("narrative",function(a){return a?new Ember.Handlebars.SafeString(a):null});jQuery(document).foundation();App=Ember.Application.create({});App.Router.map(function(){this.resource("artwork",function(){this.route("category",{path:":category_slug"})});this.resource("about");this.resource("books_main",{path:"/books"});this.resource("books",{path:"/books/:book_slug"})});App.ApplicationAdapter=DS.ActiveModelAdapter.extend({buildURL:function(){return"wp-admin/admin-ajax.php"}});App.ApplicationSerializer=DS.ActiveModelSerializer;App.CategoriesTransform=DS.Transform.extend({serialize:function(a){return a},deserialize:function(a){return a}});App.showArtModal=Ember.Mixin.create({needs:["artwork_modal"],actions:{show:function(a){this.send("openModal",{modal:"artwork_modal"});this.get("controllers.artwork_modal").setProperties({model:a,parent:this,artIndex:this.getIndex(a),isOpen:!0})}},getIndex:function(a){var b=0;this.forEach(function(c,d){c.get("id")===a.get("id")&&(b=d)});return b}});App.loadingScreen=Ember.Mixin.create({beforeModel:function(){jQuery("#loading-screen").fadeIn(0)},afterModel:function(){jQuery("#loading-screen").fadeOut(400)}});App.ApplicationRoute=Ember.Route.extend({actions:{openModal:function(a){"undefined"!==typeof a.modal&&(this.render(a.modal,{into:"application",outlet:"modal"}),jQuery("#modal, .modal-bg").addClass("show"))},closeModal:function(a){this.disconnectOutlet({outlet:"modal",parentView:"application"});this.controllerFor("artwork_modal").set("isOpen",!1);jQuery("#modal, .modal-bg").removeClass("show")}},model:function(){return Ember.RSVP.all([this.get("store").find("book",{action:"get_books"}),this.get("store").find("artworkCategory",
{action:"get_artwork_categories"}),this.get("store").find("contact",1)])},setupController:function(a,b){a.setProperties({model:{},books:b[0],artworkCategories:b[1],contact:b[2]})}});App.LoadingRoute=Ember.Route.extend({});App.AboutRoute=Ember.Route.extend(App.loadingScreen,{model:function(){return this.get("store").find("about",1)},setupController:function(a,b){a.setProperties({model:b,contact:this.get("store").find("contact",1)})}});App.ArtworkRoute=Ember.Route.extend({model:function(a){"undefined"===typeof this.get("artwork")&&this.set("artwork",this.get("store").findQuery("artwork",{action:"get_artwork"}));return this.get("artwork")}});App.ArtworkIndexRoute=Ember.Route.extend(App.showArtModal,{redirect:function(){this.transitionTo("artwork.category","illustration")}});
App.ArtworkCategoryRoute=Ember.Route.extend(App.showArtModal,{model:function(a){return Ember.RSVP.all([this.modelFor("artwork").filter(function(b){return b.get("categories").contains(a.category_slug)}),this.get("store").filter("artworkCategory",function(b){return b.get("slug")===a.category_slug})])},setupController:function(a,b){a.setProperties({model:b[0],category:b[1]})}});App.BooksRoute=Ember.Route.extend({model:function(a){var b=this.get("store").filter("book",function(b){return b.get("slug")===a.book_slug});return b?b.objectAt(0):!1}});App.BooksMainRoute=Ember.Route.extend({redirect:function(){this.transitionTo("books","the_chorus_of_kibale")}});App.IndexRoute=Ember.Route.extend({redirect:function(){this.transitionTo("artwork.category","illustration")}});App.ApplicationController=Ember.ObjectController.extend({windowObject:jQuery(window),windowHeight:0,init:function(){this._super();var a=this,b=app.isAdmin?28:0;a.set("windowHeight",a.get("windowObject").outerHeight()-b);a.get("windowObject").on("resize",function(){a.set("windowHeight",a.get("windowObject").outerHeight()-b)})},closeArtModal:function(){this.send("closeModal")},loadingScreenHeight:function(){return"height:"+this.get("windowHeight")+"px;"}.property("windowHeight")});App.ArtworkCategoryController=Ember.ArrayController.extend(App.showArtModal,{artworkCategory:function(){return this.get("category.firstObject")?this.get("category.firstObject"):!1}.property("category.length")});App.ArtworkModalController=Ember.ObjectController.extend({needs:["application"],artIndex:0,isOpen:!1,init:function(){this.bindKeypress();this._super()},actions:{closeArtModal:function(){this.send("closeModal")},nextItem:function(){this.goToNextItem()},previousItem:function(){this.goToPreviousItem()}},bindKeypress:function(){var a=this;jQuery(window).on("keyup",function(b){a.keyupNavigation(b)})},keyupNavigation:function(a){this.get("isOpen")&&(a=a.keyCode?a.keyCode:a.which,39===a?this.goToNextItem():
37===a&&this.goToPreviousItem())},goToNextItem:function(){var a=this.get("artIndex")+1>=this.get("parent.length")?0:this.get("artIndex")+1;this.setProperties({model:this.get("parent").objectAt(a),artIndex:a,parent:this.get("parent")})},goToPreviousItem:function(){var a=0>=this.get("artIndex")?this.get("parent.length")-1:this.get("artIndex")-1;this.setProperties({model:this.get("parent").objectAt(a),artIndex:a,parent:this.get("parent")})}});App.AboutController=Ember.ObjectController.extend({narrativeWidth:function(){return"max-width:"+(this.get("image")?this.get("image.width"):0)+"px;"}.property("image.width")});App.BookPagesController=Ember.ArrayController.extend(App.showArtModal);App.NavigationView=Ember.View.extend({classNames:["nav"],elementInserted:!1,didInsertElement:function(){this.set("elementInserted",!0);this.showNavLinks(this.routeEl())},routeTransition:function(){var a=this.routeEl();a.hasClass("open")||(this.closeAll(),this.showNavLinks(a));this.get("controller").closeArtModal()}.observes("controller.currentPath"),routeEl:function(){var a=this.get("controller.currentPath").split(".")[0];return this.$().find(".parent-link."+a)},showNavLinks:function(a){var b=a.parent(),
c=a.next().outerHeight();a.addClass("open");b.css({height:"+="+c+"px"})},closeNavLinks:function(a){var b=a.parent();a.removeClass("open");b.css({height:20})},closeAll:function(){var a=this;a.$().find(".section .parent-link").each(function(){var b=jQuery(this);b.hasClass("open")&&a.closeNavLinks(b)})}});App.ArtworkModalView=Ember.View.extend({isRendered:!1,didInsertElement:function(){this.set("isRendered",!0);this.setModalDimensions();this.imageLoaded()},elementChanged:function(){this.fadeInLoadingOverlay();this.imageLoaded()}.observes("controller.model"),windowSizeChanged:function(){this.setModalDimensions()}.observes("controller.controllers.application.windowHeight"),setModalDimensions:function(){if(this.get("isRendered")){var a=this.get("controller.controllers.application.windowHeight"),b=this.$().find(".artwork-details").outerHeight(),
b=a-80-40-b;this.$().find(".art-modal").css({height:a-80});this.$().find(".art-modal-image").css({height:b,"line-height":b+"px"})}},imageLoaded:function(){var a=this;if(this.get("isRendered")){var b=new Image;b.src=this.get("controller.image.url");b.onload=function(){a.fadeOutLoadingOverlay();a.setModalDimensions()}}},fadeOutLoadingOverlay:function(){var a=this.$().find(".loading-overlay");this.get("isRendered")&&a.animate({opacity:0},500,function(){a.css({display:"none"})})},fadeInLoadingOverlay:function(){this.get("isRendered")&&
this.$().find(".loading-overlay").css({opacity:1,display:"block"})}});App.ArtworkCategory=DS.Model.extend({name:DS.attr("string"),categoryDescription:DS.attr("string"),slug:DS.attr("string")});App.ArtworkCategorySerializer=App.ApplicationSerializer.extend({extractArray:function(a,b,c,d,e){c.artwork_categories.forEach(function(a){a.id=a.term_id});return this._super(a,b,c,d,e)}});App.Artwork=DS.Model.extend({title:DS.attr("string"),medium:DS.attr("string"),description:DS.attr("string"),thumbnail:DS.belongsTo("imageObject"),image:DS.belongsTo("imageObject"),categories:DS.attr("categories"),bookTitle:DS.attr("string")});
App.ArtworkSerializer=App.ApplicationSerializer.extend({extractArray:function(a,b,c,d,e){var f=c.artworks.mapProperty("image"),g=c.artworks.mapProperty("thumbnail");c.image_object=f.concat(g);c.artworks.forEach(function(a){a.image_id=a.image.id;a.thumbnail_id=a.thumbnail.id;delete a.image;delete a.thumbnail});return this._super(a,b,c,d,e)}});App.About=DS.Model.extend({image:DS.belongsTo("imageObject"),narrativeOne:DS.attr("string"),narrativeTwo:DS.attr("string")});App.AboutAdapter=App.ApplicationAdapter.extend({buildURL:function(a,b){return this._super(a,b)+"?action=get_about"}});App.AboutSerializer=App.ApplicationSerializer.extend({extractSingle:function(a,b,c,d,e){c.about.id=d;c.image_object=[c.about.image];c.about.image_id=c.image_object[0].id;return this._super(a,b,c,d,e)}});App.Contact=DS.Model.extend({contactNarrative:DS.attr("string"),email:DS.attr("string"),phone:DS.attr("string"),twitter:DS.attr("string"),storeLink:DS.attr("string"),mailTo:function(){return this.get("email")?"mailto:"+this.get("email"):null}.property("email"),twitterLink:function(){return this.get("twitter")?"https://twitter.com/"+this.get("twitter"):null}.property("twitter")});App.ContactAdapter=App.ApplicationAdapter.extend({buildURL:function(a,b){return this._super(a,b)+"?action=get_contact"}});
App.ContactSerializer=App.ApplicationSerializer.extend({extractSingle:function(a,b,c,d,e){c.contact.id=d;return this._super(a,b,c,d,e)}});App.Book=DS.Model.extend({title:DS.attr("string"),titleNotes:DS.attr("string"),bannerImage:DS.belongsTo("imageObject"),coverImage:DS.belongsTo("imageObject"),narrative:DS.attr("string"),slug:DS.attr("string"),bookPages:DS.hasMany("artwork")});
App.BookSerializer=App.ApplicationSerializer.extend({extractArray:function(a,b,c,d,e){var f=c.books.mapProperty("banner_image"),g=c.books.mapProperty("cover_image");c.image_object=f.concat(g);var h=[];c.books.forEach(function(a){a.banner_image_id=a.banner_image?a.banner_image.id:null;a.cover_image_id=a.cover_image?a.cover_image.id:null;a.book_page_ids=a.book_pages?a.book_pages.mapProperty("id"):[];a.book_pages.forEach(function(a){c.image_object.push(a.image);a.image_id=a.image.id;c.image_object.push(a.thumbnail);
a.thumbnail_id=a.thumbnail.id});h.push(a.book_pages?a.book_pages:[])});f=[];c.artwork=f.concat.apply(f,h);return this._super(a,b,c,d,e)}});App.ImageObject=DS.Model.extend({url:DS.attr("string"),height:DS.attr("number"),width:DS.attr("number")});
